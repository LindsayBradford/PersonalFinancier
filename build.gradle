apply plugin: 'java'

sourceCompatibility = '1.7'
targetCompatibility = '1.7'

project.group = "blacksmyth.personalfinancier"
project.version = "0.2"

// Storing all dependencies in a libs directory. 

repositories {
   flatDir {
     dirs 'libs'  
   }
}

dependencies {
  compile 'jtattoo:JTattoo:1.6.10'
  compile 'json-io:json-io:2.5.1'
  compile 'gral-core:gral-core:0.9'
  compile 'bcprov:bcprov:1.50'
}

// modify the sourceSets to match the layout of my java-only project.

sourceSets {
  main {
    java {
      srcDir 'src'
    }
    resources {
      srcDir 'src/blacksmyth/resources'
    }
  }
//  output.resourcesDir = 'build/classes/main/blacksmyth/resources'
}

// Sub-par.  How can I set this nicely from within sourceSets?
// the sourceset command above is parsed, but doesn't seem to have
// effect at processResources task execution time.

processResources {
  destinationDir = file('build/classes/main/blacksmyth/resources')
}

jar {
  // Merge jars we're dependent on into the executable jar.

  from { 
    configurations.compile.collect { 
      it.isDirectory() ? it : zipTree(it)
    } 
  }

  manifest {
    attributes 'Main-Class' : 'blacksmyth.personalfinancier.PersonalFinancier'
  }
}


// upload the finalised archive (jar) to a single repository being the 
// flat directory 'dist'.

uploadArchives {
  repositories {
    flatDir {
      dirs 'dist'
    }
  }
}

task dist {
  dependsOn uploadArchives
}

// the full task is the gradle equivalent of the ant script's 
// full target.

task full {
  dependsOn clean, dist
}
